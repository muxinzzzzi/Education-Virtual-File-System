---
name: 审稿与VFS特性方案
overview: 为现有C++审稿系统扩展多轮审稿/匿名化/细分决策，并为自研VFS补齐日志、COW快照、崩溃恢复与校验能力。
todos:
  - id: review-model
    content: 定义轮次/匿名/决策协议与VFS存储结构
    status: completed
  - id: review-server
    content: 实现多轮审稿、匿名化与细分决策逻辑
    status: completed
    dependencies:
      - review-model
  - id: client-ui
    content: 更新客户端菜单与展示以支持新参数与状态
    status: completed
    dependencies:
      - review-model
  - id: vfs-journal
    content: 为VFS添加WAL与恢复流程
    status: completed
  - id: vfs-cow
    content: 实现COW快照与校验/恢复校验
    status: completed
    dependencies:
      - vfs-journal
  - id: tests-docs
    content: 补充分层测试与文档说明
    status: completed
    dependencies:
      - review-server
      - client-ui
      - vfs-cow
---

# 审稿与VFS特性实施计划

## 审稿业务逻辑完善

- 扩展协议与数据模型：在 `common/protocol.h`/`src/common/protocol.cpp` 中补充审稿轮次、匿名模式枚举与决策映射，约定服务端接受 `round`、`blind`、`decision` 等参数；在 VFS 目录内为每篇论文建立 `rounds/<round>/reviews`、`assignments.txt`、`status.json`，便于持久化轮次与状态。
- 服务器逻辑：在 [`src/server/review_server.cpp`](/home/cz/os%20homework/Education-Virtual-File-System/src/server/review_server.cpp) 补全 `handle_make_decision`，并重构上传/分配/提交/查看逻辑以感知当前轮次、支持 Round 1/2/Rebuttal 切换及 Accept/Minor/Major/Reject 细分状态；加入匿名化策略（Single/Double-blind）控制返回的 reviewer/author 标识；按角色过滤 `VIEW_*` 结果以满足“查看审稿状态区分”需求。
- 客户端交互：在 [`src/client/review_client.cpp`](/home/cz/os%20homework/Education-Virtual-File-System/src/client/review_client.cpp) 的菜单与命令中增加轮次/匿名模式输入提示，显示细分决策与当前轮次进度。

## 高级文件系统特性

- 日志型文件系统（Journaling）：在 `include/filesystem/vfs*.h` 与 `src/filesystem/vfs.cpp`/`vfs_io.cpp` 增加简化 WAL，记录块写入/元数据更新的事务头、payload、commit 标记；mount 时重放未提交或回滚不完整事务，并提供 `JournalStats` 统计接口供 `SYSTEM_STATUS` 输出。
- Copy-on-Write 快照：在 `VirtualFileSystem` 增加 `create_snapshot`/`restore_snapshot`（或增强现有 `create_backup`），通过写时拷贝跟踪已修改块（增设快照索引文件存放原块拷贝），支持多快照列表/恢复，保持与现有备份命令兼容。
- 崩溃恢复一致性与校验：为数据块写入附加 checksum（如 superblock 保留区或独立校验表），读时校验；在 mount/恢复流程加入一致性扫描与报告；撰写最小“崩溃-重放”自测（基于 `tests/` 或新增小型单元测试）演示日志重放成功。

## 测试与文档

- 增补端到端用例（多轮审稿、匿名下载、决策状态），以及 VFS 日志/快照/校验的回归步骤，记录在 `docs/REQUIREMENTS.md` 或新增 `docs/RECOVERY.md`；更新 `README.md` 的功能列表和使用方式。

## 参考流程图

```mermaid
flowchart TD
  submit[SubmitPaper] --> assign[AssignReviewers]
  assign --> round1[Round1Review]
  round1 --> rebuttal[Rebuttal]
  rebuttal --> round2[Round2Review]
  round2 --> decision[FinalDecision(Accept/Minor/Major/Reject)]
  decision --> archive[Archive/Backup(COW+Journal)]





```